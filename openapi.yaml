openapi: 3.0.3
openapi: 3.0.3

info:
  title: GoAgile E-Invoicing RESTful APIs
  version: 2.0.0
  description: |
    ## GoAgile E-Invoice APIs

    The **GoAgile E-Invoice APIs** provide a powerful, simple, and scalable solution  
    for seamless e-invoicing compliance with **ZATCA‚Äôs FATOORAH regulations**.

    Designed for:

    - **Phase 1 (Generation)**
    - **Phase 2 (Integration & Clearance)**

    These APIs enable businesses to generate, validate, sign, report, and clear
    electronic invoices in full accordance with ZATCA standards.

    With GoAgile‚Äôs modern RESTful architecture, developers can quickly integrate
    invoicing capabilities into ERP, POS, and custom systems‚Äîensuring
    reliability, speed, and regulatory compliance without complexity.

    ---

    ## Key Features

    - ‚úÖ ZATCA-compliant e-invoice generation & QR code embedding  
    - üîê Secure XML signing and Phase 2 clearance integration  
    - ‚ö° High-performance APIs for large-volume invoicing  
    - üîÑ Real-time validation, reporting, and monitoring  
    - üß© Easy integration with ERP, POS, and custom software  

  termsOfService: https://goagile.com/terms

  contact:
    name: GoAgile API Support
    email: support@goagile.com
    url: https://goagile.com

  license:
    name: Proprietary
      
servers:
  - url: http://{remote_hostname}:{port}
    variables:
      remote_hostname:
        default: api.example.com
      port:
        default: "80"

components:

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    # =============================
    # AUTH
    # =============================

    AuthRequest:
      type: object
      required: [vat_number, username, secret]
      properties:
        vat_number:
          type: string
        username:
          type: string
        secret:
          type: string

    AuthResponse:
      type: object
      properties:
        token:
          type: string
        expires_in:
          type: integer

    # =============================
    # COMMON STRUCTURES
    # =============================

    TaxCategory:
      type: object
      properties:
        id:
          type: string
        percent:
          type: number
          format: float
        tax_type:
          type: string

    TaxSubtotal:
      type: object
      properties:
        taxable_amount:
          type: number
        tax_amount:
          type: number
        tax_percent:
          type: number
        tax_category:
          $ref: "#/components/schemas/TaxCategory"

    TaxTotal:
      type: object
      properties:
        currency:
          type: string
        tax_amount:
          type: number
        rounding_amount:
          type: number
        tax_subtotal:
          $ref: "#/components/schemas/TaxSubtotal"

    AllowanceCharge:
      type: object
      properties:
        charge_indicator:
          type: boolean
        reason:
          type: string
        amount:
          type: number
        base_amount:
          type: number
        currency:
          type: string
        tax_category:
          $ref: "#/components/schemas/TaxCategory"

    Address:
      type: object
      properties:
        street_name:
          type: string
        building_number:
          type: string
        plot_identification:
          type: string
        city_subdivision_name:
          type: string
        city_name:
          type: string
        postal_zone:
          type: string
        country:
          type: string
        country_subentity:
          type: string

    PartyIdentification:
      type: object
      properties:
        scheme:
          type: string
        id:
          type: string

    Party:
      type: object
      properties:
        vat_number:
          type: string
        tax_type:
          type: string
        registration_name:
          type: string
        address:
          $ref: "#/components/schemas/Address"
        party_identification:
          $ref: "#/components/schemas/PartyIdentification"

    Item:
      type: object
      properties:
        name:
          type: string
        classified_tax_category:
          $ref: "#/components/schemas/TaxCategory"

    Price:
      type: object
      properties:
        currency:
          type: string
        price_per_unit:
          type: number
        base_unit_code:
          type: string
        base_quantity:
          type: number
        allowance_charge:
          $ref: "#/components/schemas/AllowanceCharge"

    DocumentReference:
      type: object
      properties:
        id:
          type: string
        issue_date:
          type: string
          format: date
        issue_time:
          type: string

    InvoiceLine:
      type: object
      properties:
        id:
          type: string
        unit_code:
          type: string
        quantity:
          type: number
        amount:
          type: number
        doc_ref:
          $ref: "#/components/schemas/DocumentReference"
        tax_total:
          $ref: "#/components/schemas/TaxTotal"
        item:
          $ref: "#/components/schemas/Item"
        price:
          $ref: "#/components/schemas/Price"

    LegalMonitoryTotal:
      type: object
      properties:
        total_amount:
          type: number
        tax_exclusive_amount:
          type: number
        tax_inclusive_amount:
          type: number
        allowance_total_amount:
          type: number
        prepaid_amount:
          type: number
        payable_amount:
          type: number

    Notification:
      type: object
      properties:
        notification_type:
          type: string
        receiver_id:
          type: string

    # =============================
    # BASE DOCUMENT
    # =============================

    BaseDocument:
      type: object
      properties:
        invoice_number:
          type: string
        creditnote_number:
          type: string
        debitnote_number:
          type: string

        invoice_type:
          type: string
        creditnote_type:
          type: string
        debitnote_type:
          type: string

        billing_reference:
          type: string

        issue_date:
          type: string
          format: date
        issue_time:
          type: string

        due_date:
          type: string
          format: date

        is_advance_payment:
          type: boolean

        language_id:
          type: string

        note:
          type: string

        doc_currency_code:
          type: string

        tax_currency_code:
          type: string

        payment_means:
          type: string
        payment_means_instruction_note:
          type: string
        payment_means_code:
          type: integer

        actual_delivery_date:
          type: string
          format: date
        latest_delivery_date:
          type: string
          format: date

        send_notification:
          $ref: "#/components/schemas/Notification"

        supplier_info:
          $ref: "#/components/schemas/Party"

        customer_info:
          $ref: "#/components/schemas/Party"

        allowance_charge:
          $ref: "#/components/schemas/AllowanceCharge"

        tax_total:
          $ref: "#/components/schemas/TaxTotal"

        legal_monitory_total:
          $ref: "#/components/schemas/LegalMonitoryTotal"

        invoice_lines:
          type: array
          items:
            $ref: "#/components/schemas/InvoiceLine"

    # =============================
    # NOTIFY CONFIG
    # =============================

    WhatsappConfig:
      type: object
      properties:
        access_token:
          type: string
        instance_id:
          type: string
        message_template:
          type: string

    NotifyConfig:
      type: object
      properties:
        active:
          type: boolean
        whatsapp_config:
          $ref: "#/components/schemas/WhatsappConfig"

paths:

  /v1/e-invoicing/auth:
    post:
      summary: Authenticate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        "200":
          description: Token generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"

  /v1/e-invoicing/{onboard_id}/invoices:
    post:
      security:
        - BearerAuth: []
      parameters:
        - name: onboard_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BaseDocument"
      responses:
        "200":
          description: Invoice processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  invoice_id:
                    type: string
                  zatca_status:
                    type: string

  /v1/e-invoicing/{onboard_id}/credit-notes:
    post:
      security:
        - BearerAuth: []
      parameters:
        - name: onboard_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BaseDocument"
      responses:
        "200":
          description: Credit note processed

  /v1/e-invoicing/{onboard_id}/debit-notes:
    post:
      security:
        - BearerAuth: []
      parameters:
        - name: onboard_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BaseDocument"
      responses:
        "200":
          description: Debit note processed

  /v1/e-invoicing/{onboard_id}/notify-config:
    post:
      security:
        - BearerAuth: []
      parameters:
        - name: onboard_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotifyConfig"
      responses:
        "200":
          description: Notification updated
